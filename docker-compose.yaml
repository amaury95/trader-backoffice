version: "3"
services:
  keycloak:
    image: jboss/keycloak:12.0.2
    restart: unless-stopped
    ports:
      - 8180:8080
    environment:
      KEYCLOAK_IMPORT: /tmp/realm.json
    volumes:
      - ./config/keycloak/trader-admin-realm.json:/tmp/realm.json
    env_file: .env

  apollo:
    build: ./server
    restart: unless-stopped
    ports:
      - 4000:4000
    volumes:
      - ./server/db:/usr/src/app/db
      - ./certs:/usr/src/certs
    env_file: .env

  nginx:
    build: ./client
    restart: unless-stopped
    ports:
      - 80:80
    volumes:
      - ./config/nginx:/etc/nginx/conf.d
      - ./config/certs:/certs
    env_file: .env
